<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Shorter - {{ handler.settings['bitly']['branded_domain'] }}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet/less" type="text/css" href="{{ static_url('stylesheet/style.less') }}">
        <script src="{{ static_url('js/less.min.js') }}"></script>
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class="notification hide">
            <p>Unable to shorten link. It is not a valid url.</p>
        </div>

        <div class="container">
            <div class="page-header">
                <h1>Shorter</h1>
                <p>Branded bitlink generator for <a href="//{{ handler.settings['bitly']['branded_domain'] }}" target="_blank">{{ handler.settings['bitly']['branded_domain'] }}</a>.</p>
            </div>
            <div class="form">
                <input type="text" id="longurl" placeholder="Paste a link to shorten it"><button type="button" id="generate" class="btn-short">Shorten</button>
            </div>
            <div class="result-data hide">
                <p><a href="#" target="_blank" id="orignalurl"></a></p>
                <p>
                    <a href="#" target="_blank" class="short" id="shorturl"></a>
                    <button type="button" class="btn-copy" id="copy">Copy</button>
                    <span class="copied">Copied</span>
                    <span id="click-count" title="0 clicks">
                        <span>0</span>
                        <img src="{{ static_url('img/statistics.png') }}" width="12px" height="12px" alt="Statistics">
                    </span>
                </p>
            </div>
        </div>
    </body>
    <script type="text/javascript" src="{{ static_url('js/jquery.min.js') }}"></script>
    <script type="text/javascript" src="{{ static_url('js/clipboard.min.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            new Clipboard('#copy');

            $('#generate').click(function () {
                $('.notification').addClass('hide');

                var url = $('#longurl').val();

                $.get('/short?url=' + url, function (data) {
                    $('#orignalurl').attr('href', url).text(url);
                    $('#shorturl').attr('href', data).text(data);
                    $('#copy').attr('data-clipboard-text', data);
                    $('.result-data').removeClass('hide');

                    $.get('/clicks?url=' + data, function (data) {
                        $('#click-count').attr('title', data + ' clicks').find('span').text(data);
                    });
                })
                .fail(function () {
                    $('.notification').removeClass('hide');

                    setTimeout(function () {
                        $('.notification').addClass('hide');
                    }, 10 * 1000);
                });
            });

            $('#copy').click(function () {
                $(".copied").fadeIn(700, function(){
                    window.setTimeout(function(){
                        $('.copied').fadeOut();
                    }, 2 * 1000);
                });
            });
        });
    </script>
</html>